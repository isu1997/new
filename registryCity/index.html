<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registry City - ××’×Ÿ ×¢×œ ×”×¢×™×¨ ×”×“×™×’×™×˜×œ×™×ª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
            position: relative;
        }
        
        .game-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        /* ×›×•×›×‘×™× ×‘×¨×§×¢ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* ×ª×¤×¨×™×˜ ×¤×ª×™×—×” */
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            min-height: 100vh;
            text-align: center;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            z-index: 10;
            position: relative;
            padding: 2rem 1rem;
            box-sizing: border-box;
        }
        
        .game-title {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00d2ff, #3a7bd5, #00d2ff);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(0,210,255,0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .game-subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
            margin-bottom: 3rem;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .menu-btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border: 2px solid #00d2ff;
            background: rgba(0,210,255,0.1);
            color: #00d2ff;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
            font-family: 'Rubik', sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0,210,255,0.3);
        }
        
        .menu-btn:hover {
            background: rgba(0,210,255,0.2);
            box-shadow: 0 0 20px rgba(0,210,255,0.5);
            transform: translateY(-2px);
        }
        
        /* ×”×¡×ª×¨×ª ××œ×× ×˜×™× */
        .hidden {
            display: none !important;
            visibility: hidden !important;
        }
        
        /* ×ª×™×‘×ª ×“×™××œ×•×’ ××•×ª×××ª */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-box {
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #00d2ff;
            border-radius: 20px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            box-shadow: 0 20px 60px rgba(0, 210, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(90deg, rgba(0, 210, 255, 0.2), rgba(58, 123, 213, 0.2));
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(0, 210, 255, 0.3);
            position: relative;
        }
        
        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #00d2ff;
            margin: 0;
            text-align: center;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            left: 1rem;
            width: 40px;
            height: 40px;
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            border-radius: 50%;
            color: #ff4444;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 68, 68, 0.4);
            transform: scale(1.1);
        }
        
        .modal-content {
            padding: 2rem;
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 1rem;
            overflow-y: auto;
            max-height: 50vh;
        }
        
        .modal-content h3 {
            color: #00d2ff;
            margin: 1.5rem 0 0.5rem 0;
            font-size: 1.2rem;
        }
        
        .modal-content h3:first-child {
            margin-top: 0;
        }
        
        .modal-content p {
            margin-bottom: 1rem;
        }
        
        .modal-content ul {
            margin: 0.5rem 0 1rem 1.5rem;
        }
        
        .modal-content li {
            margin-bottom: 0.5rem;
        }
        
        /* ××¡×š ×”××©×—×§ ×”×¨××©×™ */
        .game-screen {
            width: 100%;
            height: 100vh;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(45deg, #0f3460 0%, #1a1a2e 50%, #0f3460 100%);
            display: block;
            visibility: visible;
        }
        
        /* ×”×“×¨ ×”××©×—×§ */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            border-bottom: 2px solid #00d2ff;
            z-index: 100;
        }
        
        .city-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00d2ff;
        }
        
        .game-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .stat-value {
            color: #00ff88;
            font-weight: 700;
        }
        
        .health-bar {
            width: 200px;
            height: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444 0%, #ffaa00 50%, #00ff88 100%);
            transition: width 0.3s ease;
            width: 100%;
        }
        
        /* ××¤×ª ×”×¢×™×¨ */
        .city-map {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            height: calc(100vh - 80px);
            background: 
                radial-gradient(circle at 20% 30%, rgba(0,210,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(58,123,213,0.1) 0%, transparent 50%);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2rem;
            padding: 2rem;
        }
        
        /* ×¨×•×‘×¢×™ ×”×¢×™×¨ */
        .district {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(0,210,255,0.3);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .district:hover {
            border-color: #00d2ff;
            background: rgba(0,210,255,0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,210,255,0.2);
        }
        
        .district-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .district-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #00d2ff;
            text-align: center;
        }
        
        .district-subtitle {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 1rem;
            text-align: center;
            font-family: monospace;
        }
        
        .district-description {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #ccc;
            text-align: center;
            flex-grow: 1;
        }
        
        .district-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px rgba(0,255,136,0.5);
        }
        
        .district-status.warning {
            background: #ffaa00;
            box-shadow: 0 0 10px rgba(255,170,0,0.5);
        }
        
        .district-status.danger {
            background: #ff4444;
            box-shadow: 0 0 10px rgba(255,68,68,0.5);
        }
        
        /* ×¨×•×‘×¢ ×”×ª×¨××•×ª */
        .security-center {
            background: rgba(255,68,68,0.1) !important;
            border-color: rgba(255,68,68,0.5) !important;
        }
        
        .security-center:hover {
            border-color: #ff4444 !important;
            background: rgba(255,68,68,0.2) !important;
        }
        
        /* ×”×ª×¨××ª ××™×•× ×¦×¤×” */
        .threat-alert {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 
                0 10px 30px rgba(255, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 999;
            animation: slideInAlert 0.5s ease-out;
            max-width: 280px;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideInAlert {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .threat-alert-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .threat-alert-icon {
            font-size: 2rem;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .threat-alert-text {
            flex-grow: 1;
            font-size: 0.9rem;
            line-height: 1.3;
        }
        
        .threat-alert-text strong {
            color: #ff4444;
            font-weight: 700;
        }
        
        .threat-alert-text small {
            color: #aaa;
            font-size: 0.8rem;
        }
        
        .threat-alert-timer {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            padding: 0.3rem 0.6rem;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 45px;
            text-align: center;
        }
        
        /* ×”×ª×××•×ª ×œ××•×‘×™×™×œ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
            }
            
            .game-subtitle {
                font-size: 1rem;
                margin-bottom: 2rem;
                padding: 0 1rem;
            }
            
            .menu-btn {
                padding: 1rem 1.5rem;
                font-size: 1rem;
                min-width: 200px;
            }
            
            .game-header {
                height: 60px;
                padding: 0 1rem;
                flex-wrap: wrap;
                overflow-x: auto;
            }
            
            .city-name {
                font-size: 1.1rem;
                order: 1;
                width: 100%;
                text-align: center;
                margin-bottom: 0.5rem;
            }
            
            .game-stats {
                gap: 1rem;
                font-size: 0.8rem;
                order: 2;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .health-bar {
                width: 120px;
                height: 8px;
            }
            
            .city-map {
                top: 60px;
                height: calc(100vh - 60px);
                grid-template-columns: 1fr;
                grid-template-rows: repeat(6, 1fr);
                gap: 1rem;
                padding: 1rem;
                overflow-y: auto;
            }
            
            .district {
                padding: 1rem;
                min-height: 120px;
            }
            
            .district-icon {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }
            
            .district-title {
                font-size: 1.1rem;
            }
            
            .district-subtitle {
                font-size: 0.8rem;
            }
            
            .district-description {
                font-size: 0.8rem;
                display: none; /* ×”×¡×ª×¨×ª ×ª×™××•×¨ ×‘××•×‘×™×™×œ ×œ×—×™×¡×›×•×Ÿ ×‘××§×•× */
            }
            
            .modal-box {
                width: 95%;
                max-height: 90vh;
                margin: 1rem;
            }
            
            .modal-content {
                padding: 1rem;
                max-height: 60vh;
                font-size: 0.9rem;
            }
            
            .threat-alert {
                right: 10px;
                max-width: calc(100vw - 20px);
                font-size: 0.8rem;
            }
            
            .threat-alert-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .threat-alert-timer {
                align-self: center;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .game-title {
                font-size: 2rem;
            }
            
            .game-subtitle {
                font-size: 0.9rem;
            }
            
            .menu-btn {
                padding: 0.8rem 1rem;
                min-width: 180px;
                font-size: 0.9rem;
                touch-action: manipulation; /* ××‘×˜×™×— ××’×¢ ×˜×•×‘ ×‘××•×‘×™×™×œ */
                -webkit-tap-highlight-color: rgba(0,210,255,0.3); /* ×¦×‘×¢ ×œ×—×™×¦×” ×‘××™×™×¤×•×Ÿ */
            }
            
            .game-header {
                height: 50px;
            }
            
            .city-name {
                font-size: 1rem;
            }
            
            .game-stats {
                font-size: 0.7rem;
                gap: 0.5rem;
            }
            
            .health-bar {
                width: 80px;
                height: 6px;
            }
            
            .city-map {
                top: 50px;
                height: calc(100vh - 50px);
                padding: 0.5rem;
                gap: 0.5rem;
            }
            
            .district {
                padding: 0.8rem;
                min-height: 100px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,210,255,0.3);
            }
            
            .district-icon {
                font-size: 1.5rem;
            }
            
            .district-title {
                font-size: 1rem;
            }
            
            .district-subtitle {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ×›×•×›×‘×™× ×‘×¨×§×¢ -->
        <div class="stars"></div>
        
        <!-- ×ª×¤×¨×™×˜ ×¨××©×™ -->
        <div class="main-menu" id="mainMenu">
            <h1 class="game-title">Registry City</h1>
            <p class="game-subtitle">
                ×©×œ×•× ××œ×™× ×•×™! ×‘×¨×•×›×” ×”×‘××” ×œ×¢×™×¨ ×”×“×™×’×™×˜×œ×™×ª ×”×›×™ ××ª×§×“××ª! ğŸ™ï¸<br>
                ××ª ×¢×•××“×ª ×œ×”×¤×•×š ×œ×¨××© ×¢×™×¨ ×•×¦×¨×™×›×” ×œ×”×’×Ÿ ×¢×œ ×”×ª×•×©×‘×™× ××¤× ×™ ×ª×•×§×¤×™× ×¡×™×‘×¨×˜×™×™×.<br>
                ×œ××“×™ ×¢×œ ×¨×’×™×¡×˜×¨×™ Windows ×ª×•×š ×›×“×™ ××©×—×§ ××¨×ª×§!
            </p>
            <div class="menu-buttons">
                <button class="menu-btn" onclick="startGame()">ğŸš€ ×”×ª×—×™×œ×™ ××©×—×§</button>
                <button class="menu-btn" onclick="showTutorial()">ğŸ“š ××“×¨×™×š ×œ××ª×—×™×œ×•×ª</button>
                <button class="menu-btn" onclick="showAbout()">â„¹ï¸ ××•×“×•×ª ×”××©×—×§</button>
            </div>
        </div>
        
        <!-- ×ª×™×‘×ª ×“×™××œ×•×’ ××•×ª×××ª -->
        <div class="modal-overlay hidden" id="modalOverlay">
            <div class="modal-box">
                <div class="modal-header">
                    <button class="modal-close" onclick="closeModal()" title="×¡×’×•×¨">Ã—</button>
                    <h2 class="modal-title" id="modalTitle">×›×•×ª×¨×ª</h2>
                </div>
                <div class="modal-content" id="modalContent">
                    ×ª×•×›×Ÿ ×”×ª×™×‘×” ×™×•×¤×™×¢ ×›××Ÿ...
                </div>
            </div>
        </div>
        
        <!-- ××¡×š ×”××©×—×§ ×”×¨××©×™ -->
        <div class="game-screen hidden" id="gameScreen">
            <!-- ×”×“×¨ ×”××©×—×§ -->
            <div class="game-header">
                <div class="city-name">ğŸ™ï¸ Registry City - ×”×¢×™×¨ ×©×œ ××œ×™× ×•×™</div>
                <div class="game-stats">
                    <div class="stat-item">
                        ğŸ›¡ï¸ ×‘×¨×™××•×ª ×”×¢×™×¨: 
                        <div class="health-bar">
                            <div class="health-fill" id="healthFill"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        ğŸ’ × ×§×•×“×•×ª: <span class="stat-value" id="scoreValue">0</span>
                    </div>
                    <div class="stat-item">
                        ğŸ† ×¨××”: <span class="stat-value" id="levelValue">1</span>
                    </div>
                    <div class="stat-item">
                        â° ×–××Ÿ: <span class="stat-value" id="timeValue">0:00</span>
                    </div>
                    <div class="stat-item">
                        ğŸš¨ ××™×•×: <span class="stat-value" id="threatsValue">×¢×•×“ 2:00</span>
                    </div>
                </div>
            </div>
            
            <!-- ××¤×ª ×”×¢×™×¨ -->
            <div class="city-map">
                <div class="district" onclick="openDistrict('HKLM')">
                    <div class="district-status" id="status-HKLM"></div>
                    <div class="district-icon">ğŸ›ï¸</div>
                    <div class="district-title">×¨×•×‘×¢ ×”×××©×œ×”</div>
                    <div class="district-subtitle">HKEY_LOCAL_MACHINE</div>
                    <div class="district-description">
                        ×©×œ×™×˜×” ×¢×œ ×›×œ ×”×©×™×¨×•×ª×™× ×”×›×œ×œ×™×™× ×©×œ ×”×¢×™×¨. ×›××Ÿ × ××¦××™× ×”×‘× ×§×™×, ×‘×ª×™ ×”×—×•×œ×™×, 
                        ×”××©×˜×¨×” ×•×”×©×™×¨×•×ª×™× ×”×—×™×•× ×™×™× ×œ×›×œ ×”×ª×•×©×‘×™×.
                    </div>
                </div>
                
                <div class="district" onclick="openDistrict('HKCU')">
                    <div class="district-status" id="status-HKCU"></div>
                    <div class="district-icon">ğŸ </div>
                    <div class="district-title">×¨×•×‘×¢ ×”××’×•×¨×™×</div>
                    <div class="district-subtitle">HKEY_CURRENT_USER</div>
                    <div class="district-description">
                        ×”×‘×ª×™× ×”×¤×¨×˜×™×™× ×©×œ ×”×ª×•×©×‘×™×. ×›×œ ××©×ª××© ×™×›×•×œ ×œ×”×ª××™× ××ª ×”×‘×™×ª ×©×œ×• ×œ×˜×¢××• 
                        ×•×œ×©××•×¨ ××ª ×”×—×¤×¦×™× ×”××™×©×™×™× ×©×œ×•.
                    </div>
                </div>
                
                <div class="district" onclick="openDistrict('HKCR')">
                    <div class="district-status" id="status-HKCR"></div>
                    <div class="district-icon">ğŸª</div>
                    <div class="district-title">×¨×•×‘×¢ ×”××¡×—×¨</div>
                    <div class="district-subtitle">HKEY_CLASSES_ROOT</div>
                    <div class="district-description">
                        ×”××¨×›×– ×”××¡×—×¨×™ ×©×œ ×”×¢×™×¨. ×›××Ÿ ××—×œ×™×˜×™× ××™×–×” ×—× ×•×ª ×ª×˜×¤×œ ×‘××™×–×” ×¡×•×’ ×œ×§×•×—,
                        ×•××™×š ×©×™×¨×•×ª×™× ×©×•× ×™× ××ª×§×©×¨×™× ×–×” ×¢× ×–×”.
                    </div>
                </div>
                
                <div class="district" onclick="openDistrict('HKU')">
                    <div class="district-status" id="status-HKU"></div>
                    <div class="district-icon">ğŸ‘¥</div>
                    <div class="district-title">×›×™×›×¨ ×”×ª×•×©×‘×™×</div>
                    <div class="district-subtitle">HKEY_USERS</div>
                    <div class="district-description">
                        ×”××§×•× ×‘×• ××ª××¡×¤×™× ×›×œ ×ª×•×©×‘×™ ×”×¢×™×¨. ×›××Ÿ ××¤×©×¨ ×œ×¨××•×ª ××ª ×›×œ ×”××©×ª××©×™× 
                        ×•×œ× ×”×œ ××ª ×”×§×©×¨×™× ×‘×™× ×™×”×.
                    </div>
                </div>
                
                <div class="district" onclick="openDistrict('HKCC')">
                    <div class="district-status" id="status-HKCC"></div>
                    <div class="district-icon">âš™ï¸</div>
                    <div class="district-title">××¨×›×– ×”×‘×§×¨×”</div>
                    <div class="district-subtitle">HKEY_CURRENT_CONFIG</div>
                    <div class="district-description">
                        ××¨×›×– ×”×‘×§×¨×” ×”××¨×›×–×™ ×©×œ ×”×¢×™×¨. ×›××Ÿ ×× ×•×”×œ×•×ª ×”×”×’×“×¨×•×ª ×”× ×•×›×—×™×•×ª ×©×œ ×›×œ 
                        ×”×¦×™×•×“ ×•×”×ª×©×ª×™×•×ª ×”×¤×¢×™×œ×•×ª ×›×¨×’×¢.
                    </div>
                </div>
                
                <div class="district security-center" onclick="openSecurityCenter()">
                    <div class="district-status danger" id="status-security"></div>
                    <div class="district-icon">ğŸš¨</div>
                    <div class="district-title">××¨×›×– ×”×”×ª×¨××•×ª</div>
                    <div class="district-subtitle">Security Operations Center</div>
                    <div class="district-description">
                        ××¨×›×– ×‘×™×˜×—×•×Ÿ ×”×¢×™×¨. ×›××Ÿ ×ª×•×¤×™×¢ ×”×ª×¨××•×ª ×¢×œ ×”×ª×§×¤×•×ª, ×•×ª×•×›×œ×™ ×œ× ×”×œ ××ª 
                        ×”×’× ×•×ª ×”×¢×™×¨ ×•×œ×—×§×•×¨ ××™×¨×•×¢×™ ××‘×˜×—×”.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ××©×ª× ×™ ×”××©×—×§ - ××•×ª×× ×œ××ª×—×™×œ×•×ª
        let gameState = {
            health: 100,
            score: 0,
            level: 1,
            threats: 0,
            gameTime: 0,
            isGameRunning: false,
            timeToFirstThreat: 120, // 2 ×“×§×•×ª ×¢×“ ×”××™×•× ×”×¨××©×•×Ÿ
            timeBetweenThreats: 60, // 60 ×©× ×™×•×ª ×‘×™×Ÿ ××™×•××™× ×‘×¨××” 1
            isLearningModalOpen: false, // ××©×ª× ×” ×—×“×© ×œ×‘×“×™×§×” ×× ×™×© ×—×œ×•× ×™×ª ×œ××™×“×” ×¤×ª×•×—×”
            timeSinceLastThreat: 0 // ×–××Ÿ ×©×¢×‘×¨ ×××– ×”××™×•× ×”××—×¨×•×Ÿ
        };
        
        let activeThreats = [];
        let gameTimer = null;
        
        // ×‘× ×§ ××§×¨×™× ××¤×•×¨×˜×™× ×¢× ×”×¡×‘×¨×™× ×œ××ª×—×™×œ×•×ª
        const districtCases = {
            'HKLM': [
                {
                    name: 'Registry Persistence Malware',
                    nameExplained: '×ª×•×›× ×ª ×–×™×•×Ÿ ×©××ª××§××ª ×‘×¨×’×™×¡×˜×¨×™',
                    description: '×ª×•×§×£ ×”×¡×ª×™×¨ ×ª×•×›× ×” ×–×“×•× ×™×ª ×©×ª×•×¤×¢×œ ×‘×›×œ ×”×¤×¢×œ×” ×©×œ ×”××—×©×‘',
                    path: 'HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run',
                    pathExplained: '×–×”×• ×”××§×•× ×‘×¨×’×™×¡×˜×¨×™ ×©××•××¨ ×œ-Windows ××™×–×” ×ª×•×›× ×•×ª ×œ×”×¤×¢×™×œ ×›×©×”××—×©×‘ × ×“×œ×§',
                    malicious: 'WindowsDefender = "C:\\Windows\\System32\\fake_defender.exe"',
                    maliciousBreakdown: {
                        name: 'WindowsDefender',
                        explanation: '×”×©× × ×¨××” ×—×£ ××¤×©×¢ - ×›××™×œ×• ×–×” ×× ×˜×™-×•×™×¨×•×¡ ×©×œ ××™×§×¨×•×¡×•×¤×˜',
                        path: 'C:\\Windows\\System32\\fake_defender.exe',
                        pathExplanation: '×”× ×ª×™×‘ ××•×‘×™×œ ×œ×§×•×‘×¥ ××–×•×™×£ ×©××ª×—×–×” ×œ×× ×˜×™-×•×™×¨×•×¡ ×××™×ª×™'
                    },
                    realWorld: 'Malware (×ª×•×›× ×•×ª ×–×“×•× ×™×•×ª) ××©×ª××©×•×ª ×‘×˜×›× ×™×§×” ×–×• ×›×“×™ "×œ×©×¨×•×“" ×‘××—×©×‘ - ×’× ×× ×ª× ×¡×™ ×œ××—×•×§ ××•×ª×Ÿ, ×”×Ÿ ×™×—×–×¨×• ×‘×”×¤×¢×œ×” ×”×‘××”',
                    threats: ['×”××—×©×‘ ×™×¤×¢×™×œ ×ª×•×›× ×” ×–×“×•× ×™×ª ×‘×›×œ ×”×¤×¢×œ×”', '×’× ×™×‘×ª ××™×“×¢ ××™×©×™', '×”××˜×ª ×”××—×©×‘'],
                    howToSpot: '×ª×•×›× ×•×ª ×©×œ× ×–×•×›×¨×ª ×©×”×ª×§× ×ª ×‘×¨×©×™××ª ×”×”×¤×¢×œ×”'
                },
                {
                    name: 'Malicious Service Installation',
                    nameExplained: '×”×ª×§× ×ª ×©×™×¨×•×ª ××—×©×‘ ×–×“×•× ×™',
                    description: '×©×™×¨×•×ª Windows ××–×•×™×£ ×”×•×ª×§×Ÿ ×‘××¢×¨×›×ª ×¢× ×”×¨×©××•×ª ×’×‘×•×”×•×ª',
                    path: 'HKLM\\System\\CurrentControlSet\\Services\\FakeAntivirus',
                    pathExplained: '×›××Ÿ × ×¨×©××™× ×›×œ ×”×©×™×¨×•×ª×™× ×©×œ Windows - ×ª×•×›× ×•×ª ×©×¨×¦×•×ª ×‘×¨×§×¢ ×•×× ×”×œ×•×ª ××ª ×”××—×©×‘',
                    malicious: 'ImagePath = "C:\\ProgramData\\backdoor.exe"',
                    maliciousBreakdown: {
                        name: 'ImagePath',
                        explanation: '×–×” ××•××¨ ×œ-Windows ××™×–×” ×§×•×‘×¥ ×œ×”×¤×¢×™×œ ×¢×‘×•×¨ ×”×©×™×¨×•×ª ×”×–×”',
                        path: 'C:\\ProgramData\\backdoor.exe',
                        pathExplanation: 'backdoor = "×“×œ×ª ××—×•×¨×™×ª" - ×ª×•×›× ×” ×©× ×•×ª× ×ª ×œ×ª×•×§×£ ×’×™×©×” ×—×‘×•×™×” ×œ××—×©×‘'
                    },
                    realWorld: 'Services (×©×™×¨×•×ª×™×) ×¨×¦×™× ×¢× ×”×¨×©××•×ª ×××•×“ ×’×‘×•×”×•×ª ×‘××—×©×‘ - ×–×” ×›××• ×œ×ª×ª ×œ××™×©×”×• ×–×¨ ××¤×ª×— ×œ×‘×™×ª ×©×œ×š',
                    threats: ['×©×œ×™×˜×” ××œ××” ×‘××—×©×‘', '×’×™×©×” ×œ×›×œ ×”×§×‘×¦×™×', '××¢×§×‘ ××—×¨ ×¤×¢×™×œ×•×ª'],
                    howToSpot: '×©×™×¨×•×ª×™× ×¢× ×©××•×ª ×—×©×•×“×™× ××• × ×ª×™×‘×™× ×œ× ×¨×’×™×œ×™×'
                }
            ],
            'HKCU': [
                {
                    name: 'Browser Homepage Hijack',
                    nameExplained: '×—×˜×™×¤×ª ×“×£ ×”×‘×™×ª ×©×œ ×”×“×¤×“×¤×Ÿ',
                    description: '×“×£ ×”×‘×™×ª ×©×œ ×”×“×¤×“×¤×Ÿ ×©×•× ×” ×œ××ª×¨ ×–×“×•× ×™ ×©××¦×™×’ ×¤×¨×¡×•××•×ª ××• × ×•×¡×” ×œ×’× ×•×‘ ××™×“×¢',
                    path: 'HKCU\\Software\\Microsoft\\Internet Explorer\\Main',
                    pathExplained: '×›××Ÿ × ×©××¨×•×ª ×”×”×’×“×¨×•×ª ×”××™×©×™×•×ª ×©×œ ×“×¤×“×¤×Ÿ Internet Explorer ×©×œ×š',
                    malicious: 'Start Page = "http://malicious-ads-site.com"',
                    maliciousBreakdown: {
                        name: 'Start Page',
                        explanation: '×–×” ×§×•×‘×¢ ××™×–×” ××ª×¨ × ×¤×ª×— ×›×©××ª×” ×¤×•×ª×— ××ª ×”×“×¤×“×¤×Ÿ',
                        path: 'http://malicious-ads-site.com',
                        pathExplanation: '××ª×¨ ××–×•×™×£ ×©××¦×™×’ ×¤×¨×¡×•××•×ª ××–×™×§×•×ª ××• ×× ×¡×” ×œ×’× ×•×‘ ×¡×™×¡×××•×ª'
                    },
                    realWorld: 'Browser Hijacking (×—×˜×™×¤×ª ×“×¤×“×¤×Ÿ) ×–×• ×“×¨×š × ×¤×•×¦×” ×œ×ª×•×§×¤×™× ×œ×”×›× ×™×¡ ××•×ª×š ×œ××ª×¨×™× ××–×•×™×¤×™× ×•×œ×’× ×•×‘ ××™×“×¢',
                    threats: ['×¤×¨×¡×•××•×ª ××˜×¨×™×“×•×ª', '× ×™×¡×™×•× ×•×ª ×’× ×™×‘×ª ×¡×™×¡×××•×ª', '×”×“×‘×§×” ×‘×•×™×¨×•×¡×™× × ×•×¡×¤×™×'],
                    howToSpot: '×“×£ ×”×‘×™×ª ×©×œ×š ×”×©×ª× ×” ×œ××ª×¨ ×©×œ× ×”×›×¨×ª'
                },
                {
                    name: 'User Startup Persistence',
                    nameExplained: '×ª×•×›× ×” ×–×“×•× ×™×ª ×©××•×¤×¢×œ×ª ×¢× ×”××—×©×‘',
                    description: '×ª×•×›× ×” ×—×©×•×“×” × ×•×¡×¤×” ×œ×¨×©×™××ª ×”×ª×•×›× ×•×ª ×©××•×¤×¢×œ×•×ª ×›×©××ª×” × ×›× ×¡×ª ×œ××—×©×‘',
                    path: 'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run',
                    pathExplained: '×–×• ×”×¨×©×™××” ×”××™×©×™×ª ×©×œ×š ×©×œ ×ª×•×›× ×•×ª ×©××•×¤×¢×œ×•×ª ×›×©××ª×” × ×›× ×¡×ª ×œ××—×©×‘',
                    malicious: 'ChromeUpdater = "C:\\Users\\Elonay\\AppData\\Roaming\\chrome_fake.exe"',
                    maliciousBreakdown: {
                        name: 'ChromeUpdater',
                        explanation: '×”×©× ××ª×—×–×” ×œ××¢×“×›×Ÿ ×©×œ ×“×¤×“×¤×Ÿ Chrome, ××‘×œ ×–×” ×‘×¢×¦× ×•×™×¨×•×¡',
                        path: 'C:\\Users\\Elonay\\AppData\\Roaming\\chrome_fake.exe',
                        pathExplanation: '×”×ª×™×§×™×™×” AppData\\Roaming ×”×™× ××§×•× ×©×ª×•×§×¤×™× ××•×”×‘×™× ×œ×”×¡×ª×™×¨ ×‘×• ×§×‘×¦×™× ×–×“×•× ×™×™×'
                    },
                    realWorld: '×ª×•×§×¤×™× ××¡×ª×™×¨×™× Malware (×ª×•×›× ×•×ª ×–×“×•× ×™×•×ª) ×‘×ª×™×§×™×•×ª ×©× ×¨××•×ª ×—×¤×•×ª ××¤×©×¢ ×•× ×•×ª× ×™× ×œ×”×Ÿ ×©××•×ª ××•×›×¨×™×',
                    threats: ['×’× ×™×‘×ª ×¡×™×¡×××•×ª', '××¢×§×‘ ××—×¨ ×”×§×œ×“×”', '×’×™×©×” ×œ×ª××•× ×•×ª ×•×§×‘×¦×™× ××™×©×™×™×'],
                    howToSpot: '×ª×•×›× ×•×ª ×‘×¨×©×™××ª ×”×”×¤×¢×œ×” ×¢× ×©××•×ª ××•×›×¨×™× ××‘×œ ×‘××™×§×•××™× ××•×–×¨×™×'
                }
            ],
            'HKCR': [
                {
                    name: 'EXE File Hijacking',
                    nameExplained: '×—×˜×™×¤×ª ×§×‘×¦×™ ×”×¤×¢×œ×”',
                    description: '×›×œ ×§×‘×¦×™ ×”×”×¤×¢×œ×” (.exe) ×‘××—×©×‘ × ×—×˜×¤×• - ×¢×›×©×™×• ×›×œ ×ª×•×›× ×” ×©×ª× ×¡×™ ×œ×”×¤×¢×™×œ ×ª×¤×¢×™×œ ×§×•×“× ×•×™×¨×•×¡',
                    path: 'HKCR\\exefile\\shell\\open\\command',
                    pathExplained: '×›××Ÿ × ×§×‘×¢ ××” ×§×•×¨×” ×›×©×œ×•×—×¦×™× ×¢×œ ×§×•×‘×¥ .exe (×§×•×‘×¥ ×”×¤×¢×œ×” ×©×œ ×ª×•×›× ×”)',
                    malicious: 'Default = "C:\\malware\\launcher.exe %1"',
                    maliciousBreakdown: {
                        name: 'Default',
                        explanation: '×–×• ×”×”×•×¨××” ××” ×œ×¢×©×•×ª ×›×©×¤×•×ª×—×™× ×§×•×‘×¥ .exe',
                        path: 'C:\\malware\\launcher.exe %1',
                        pathExplanation: 'launcher.exe = ×ª×•×›× ×” ×©××¤×¢×™×œ×” ×•×™×¨×•×¡, %1 = ×”×ª×•×›× ×” ×”××§×•×¨×™×ª ×©×¨×¦×™×ª ×œ×”×¤×¢×™×œ'
                    },
                    realWorld: 'File Association (×§×™×©×•×¨ ×§×‘×¦×™×) ×§×•×‘×¢ ××™×–×” ×ª×•×›× ×” ×ª×¤×ª×— ××™×–×” ×¡×•×’ ×§×•×‘×¥. ×›×©×–×” ××©×ª×‘×©, ×›×œ ×”×§×‘×¦×™× ××¤×¢×™×œ×™× ×•×™×¨×•×¡×™×',
                    threats: ['×›×œ ×ª×•×›× ×” ×©×ª×¤×¢×™×œ×™ ×ª×“×‘×™×§ ××•×ª×š ×‘×•×™×¨×•×¡', '×”××—×©×‘ ×™×”×¤×•×š ×œ× ×©××™×©', '×”×ª×¤×©×˜×•×ª ×œ×›×œ ×”×§×‘×¦×™×'],
                    howToSpot: '×ª×•×›× ×•×ª ×œ× × ×¤×ª×—×•×ª ××• × ×¤×ª×—×•×ª ×¢× ×ª×•×›× ×•×ª ××•×–×¨×•×ª'
                },
                {
                    name: 'PDF Reader Hijack', 
                    nameExplained: '×—×˜×™×¤×ª ×ª×•×›× ×ª ×§×¨×™××ª PDF',
                    description: '×›×œ ×§×•×‘×¥ PDF ×©×ª× ×¡×™ ×œ×¤×ª×•×— ×™×¤×ª×— ×¢× ×ª×•×›× ×” ×–×“×•× ×™×ª ×‘××§×•× ×ª×•×›× ×ª ×”-PDF ×”×¨×’×™×œ×”',
                    path: 'HKCR\\.pdf\\shell\\open\\command',
                    pathExplained: '×›××Ÿ × ×§×‘×¢ ××™×–×” ×ª×•×›× ×” ×ª×¤×ª×— ×§×‘×¦×™ PDF (××¡××›×™× ×“×™×’×™×˜×œ×™×™×)',
                    malicious: 'Default = "C:\\fake_pdf_reader.exe %1"',
                    maliciousBreakdown: {
                        name: 'Default',
                        explanation: '×”×”×•×¨××” ××™×–×” ×ª×•×›× ×” ×ª×¤×ª×— ×§×‘×¦×™ PDF',
                        path: 'C:\\fake_pdf_reader.exe %1',
                        pathExplanation: 'fake_pdf_reader = ×ª×•×›× ×” ××–×•×™×¤×ª ×©××ª×—×–×” ×œ×§×•×¨× PDF ×××™×ª×™'
                    },
                    realWorld: '×ª×•×§×¤×™× ××©× ×™× ××ª File Associations (×§×™×©×•×¨×™ ×§×‘×¦×™×) ×›×“×™ ×©×›×œ ×¤×¢× ×©×ª×¤×ª×—×™ ×§×•×‘×¥ ×¨×’×™×œ, ×ª×¤×¢×™×œ×™ ×•×™×¨×•×¡',
                    threats: ['×’× ×™×‘×ª ××™×“×¢ ××§×‘×¦×™×', '×”×“×‘×§×” ×‘×•×™×¨×•×¡×™×', '×—×©×™×¤×ª ××¡××›×™× ×¤×¨×˜×™×™×'],
                    howToSpot: '×§×‘×¦×™ PDF ×œ× × ×¤×ª×—×™× ××• × ×¤×ª×—×™× ×¢× ×ª×•×›× ×•×ª ×œ× ××•×›×¨×•×ª'
                }
            ],
            'HKU': [
                {
                    name: 'Cross-User Persistence',
                    nameExplained: '×”×ª×¤×©×˜×•×ª ×‘×™×Ÿ ××©×ª××©×™× ×‘××—×©×‘',
                    description: '×ª×•×§×£ × ×™×¡×” ×œ×”×¤×¢×™×œ ×ª×•×›× ×” ×–×“×•× ×™×ª ×“×¨×š ×—×©×‘×•×Ÿ ××©×ª××© ××—×¨ ×‘××—×©×‘',
                    path: 'HKU\\S-1-5-21-1234567890-1001\\Software\\Microsoft\\Windows\\CurrentVersion\\Run',
                    pathExplained: 'S-1-5-21-1234567890-1001 ×–×” ××–×”×” ×™×™×—×•×“×™ ×©×œ ××©×ª××© ××—×¨ ×‘××—×©×‘ (×›××• ×ª×¢×•×“×ª ×–×”×•×ª ×“×™×’×™×˜×œ×™×ª)',
                    malicious: 'SystemCheck = "C:\\Windows\\Temp\\system_check.exe"',
                    maliciousBreakdown: {
                        name: 'SystemCheck',
                        explanation: '×”×©× × ×©××¢ ×›××• ×‘×“×™×§×ª ××¢×¨×›×ª ×¨×’×™×œ×”, ××‘×œ ×–×” ×•×™×¨×•×¡',
                        path: 'C:\\Windows\\Temp\\system_check.exe',
                        pathExplanation: '×ª×™×§×™×™×ª Temp × ×•×¢×“×” ×œ×§×‘×¦×™× ×–×× ×™×™×, ×œ× ×œ×ª×•×›× ×•×ª ×§×‘×•×¢×•×ª'
                    },
                    realWorld: 'Cross-User attacks (×”×ª×§×¤×•×ª ×‘×™×Ÿ-××©×ª××©×™×) ×× ×¡×•×ª ×œ×”×ª×¤×©×˜ ××—×©×‘×•×Ÿ ××—×“ ×œ×›×œ ×”××©×ª××©×™× ×‘××—×©×‘',
                    threats: ['×–×™×”×•× ×›×œ ×”×—×©×‘×•× ×•×ª ×‘××—×©×‘', '×’×™×©×” ×œ××™×“×¢ ×©×œ ×›×œ ×”××©×¤×—×”', '×”×ª×¤×©×˜×•×ª ×‘×¨×©×ª'],
                    howToSpot: '×¤×¢×™×œ×•×ª ×‘××©×ª××©×™× ×©×œ× × ××¦××™× ×›×¨×’×¢ ×‘××—×©×‘'
                }
            ],
            'HKCC': [
                {
                    name: 'Network Configuration Attack',
                    nameExplained: '×©×™× ×•×™ ×”×’×“×¨×•×ª ×”×¨×©×ª',
                    description: '×ª×•×§×£ ×©×™× ×” ××ª ×”×’×“×¨×•×ª ×”××™× ×˜×¨× ×˜ ×©×œ ×”××—×©×‘ ×›×“×™ ×œ× ×ª×‘ ××ª ×›×œ ×”×’×œ×™×©×” ×©×œ×š ×“×¨×š ×”×©×¨×ª×™× ×©×œ×•',
                    path: 'HKCC\\System\\CurrentControlSet\\Services\\Tcpip\\Parameters',
                    pathExplained: '×›××Ÿ × ×©××¨×•×ª ×”×’×“×¨×•×ª ×”××™× ×˜×¨× ×˜ ×•×”×¨×©×ª ×©×œ ×”××—×©×‘ ×©×œ×š',
                    malicious: 'NameServer = "8.8.4.4,malicious-dns.com"',
                    maliciousBreakdown: {
                        name: 'NameServer (×©×¨×ª ×©××•×ª)',
                        explanation: '×–×” ×”×©×¨×ª ×©××ª×¨×’× ×©××•×ª ××ª×¨×™× (×›××• google.com) ×œ×›×ª×•×‘×•×ª IP',
                        path: '8.8.4.4,malicious-dns.com',
                        pathExplanation: '8.8.4.4 ×–×” ×©×¨×ª ×’×•×’×œ ×”×œ×’×™×˜×™××™, ××‘×œ malicious-dns.com ×–×” ×©×¨×ª ×©×œ ×ª×•×§×£'
                    },
                    realWorld: 'DNS Hijacking (×—×˜×™×¤×ª ×©×¨×ª ×©××•×ª) ×’×•×¨××ª ×œ×›×œ ×”××ª×¨×™× ×©×ª× ×¡×™ ×œ×’×©×ª ××œ×™×”× ×œ×”×™×¤×ª×— ×‘×’×¨×¡××•×ª ××–×•×™×¤×•×ª ×©×œ ×”×ª×•×§×£',
                    threats: ['×›×œ ×”××ª×¨×™× ×™×¤× ×• ×œ×¢××•×“×™× ××–×•×™×¤×™×', '×’× ×™×‘×ª ×¡×™×¡×××•×ª', '×¨××™×™×ª ×›×œ ×”×’×œ×™×©×” ×©×œ×š'],
                    howToSpot: '××ª×¨×™× ××•×›×¨×™× × ×¨××™× ×©×•× ×” ××• ××‘×§×©×™× ×¡×™×¡×××•×ª ×©×•×‘'
                }
            ]
        };
        
        // ×™×¦×™×¨×ª ×›×•×›×‘×™× ×‘×¨×§×¢
        function createStars() {
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×ª×™×‘×ª ×“×™××œ×•×’
        function showModal(title, content) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×¡×’×™×¨×ª ×”××•×“×œ - ×¢× ××™×¤×•×¡ ×“×’×œ ×”×œ××™×“×”
        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            gameState.isLearningModalOpen = false; // ××™×¤×•×¡ ×”×“×’×œ ×›×©×¡×•×’×¨×™× ×—×œ×•× ×™×ª
        }
        
        // ×”×ª×—×œ×ª ×”××©×—×§ ×¢× ×”×ª×¨××” ×œ××ª×—×™×œ×•×ª
        function startGame() {
            console.log('ğŸ® Starting game...');
            
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // ×•×™×“×•× ×©××¡×š ×”××©×—×§ × ×¨××” ×‘××•×‘×™×™×œ
            const gameScreen = document.getElementById('gameScreen');
            gameScreen.style.display = 'block';
            gameScreen.style.visibility = 'visible';
            
            console.log('ğŸ® Game screen should be visible now');
            
            // ××™×¤×•×¡ ×”××©×—×§
            gameState.health = 100;
            gameState.score = 0;
            gameState.level = 1;
            gameState.threats = 0;
            gameState.gameTime = 0;
            gameState.isGameRunning = true;
            gameState.timeToFirstThreat = 120; // 2 ×“×§×•×ª
            gameState.timeBetweenThreats = 60; // 60 ×©× ×™×•×ª ×‘×™×Ÿ ××™×•××™× ×‘×¨××” 1
            gameState.isLearningModalOpen = false;
            gameState.timeSinceLastThreat = 0;
            activeThreats = [];
            
            updateGameUI();
            startGameLoop();
            
            // ×”×ª×¨××” ×¨××©×•× ×™×ª ×œ××ª×—×™×œ×•×ª - ×¨×§ ××—×¨×™ ×©×”××©×—×§ ×”×ª×—×™×œ!
            setTimeout(() => {
                console.log('ğŸ® Showing welcome message');
                showBeginnerWelcome();
            }, 1000);
        }
        
        // ×”×•×“×¢×ª ×‘×¨×›×” ××™×•×—×“×ª ×œ××ª×—×™×œ×•×ª
        function showBeginnerWelcome() {
            const title = 'ğŸ“ ×‘×¨×•×›×” ×”×‘××” ×œ××©×—×§, ××œ×™× ×•×™!';
            const content = `
                <p><strong>ğŸ¯ ×–×” ×”××©×—×§ ×”×¨××©×•×Ÿ ×©×œ×š ×‘×ª×—×•× ××‘×˜×—×ª ×”××™×“×¢!</strong></p>
                
                <h3>â° ××” ×™×§×¨×” ×¢×›×©×™×•:</h3>
                <ul>
                    <li><strong>×“×§×•×ª×™×™× ×”×‘××•×ª:</strong> ×ª×•×›×œ×™ ×œ×—×§×•×¨ ××ª ×”×¢×™×¨ ×‘×©×§×˜</li>
                    <li><strong>×‘×¢×•×“ 2 ×“×§×•×ª:</strong> ×™×•×¤×™×¢ ×”××™×•× ×”×¨××©×•×Ÿ ×©×œ×š</li>
                    <li><strong>×‘×¨××” 1:</strong> ×™×© ×œ×š ×”×¨×‘×” ×–××Ÿ ×œ×˜×¤×œ ×‘×›×œ ××™×•× (2 ×“×§×•×ª ××œ××•×ª!)</li>
                    <li><strong>×‘×™×Ÿ ××™×•××™×:</strong> ×“×§×” ×× ×•×—×” ×œ×œ××™×“×”</li>
                </ul>
                
                <h3>ğŸ’¡ ×˜×™×¤×™× ×œ×”×ª×—×œ×”:</h3>
                <ul>
                    <li>ğŸ  ×‘×•××™ ×ª×›×™×¨×™ ××ª ×”×¨×•×‘×¢×™× - ×œ×—×¦×™ ×¢×œ×™×”×</li>
                    <li>ğŸš¨ ×›×©×™×•×¤×™×¢ ××™×•×, ×ª×¨××™ ×”×ª×¨××” ×§×˜× ×” ×¢×œ ×”××¡×š</li>
                    <li>ğŸ” ×›×“×™ ×œ×˜×¤×œ ×‘××™×•×, ×ª×™×›× ×¡×™ ×œ××¤×” ×•×ª×œ×—×¦×™ ×¢×œ ×”×¨×•×‘×¢</li>
                    <li>ğŸ“š ×›×œ ××™×•× ×™×œ××“ ××•×ª×š ××©×”×• ×—×“×© ×¢×œ ××—×©×‘×™×!</li>
                </ul>
                
                <div style="background: rgba(0,255,136,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <p><strong>ğŸˆ ×–×›×¨×™:</strong> ×–×” ×‘×˜×•×— ×œ×œ××•×“! ××™×Ÿ ×œ×—×¥, ×™×© ×”×¨×‘×” ×–××Ÿ, ×•×× ×—× ×• ×¤×” ×›×“×™ ×œ×œ××•×“ ×‘×™×—×“.</p>
                </div>
                
                <p><strong>ğŸš€ ×‘×•××™ × ×ª×—×™×œ ×œ×—×§×•×¨ ××ª ×”×¢×™×¨!</strong></p>
            `;
            showModal(title, content);
        }
        
        // ×œ×•×œ××ª ×”××©×—×§ ×¢× ××¢×¨×›×ª ×–×× ×™× ××•×ª×××ª ×œ××ª×—×™×œ×•×ª
        function startGameLoop() {
            if (gameTimer) clearInterval(gameTimer);
            
            gameTimer = setInterval(() => {
                if (!gameState.isGameRunning) return;
                
                gameState.gameTime++;
                gameState.timeSinceLastThreat++;
                
                // ×”×¦×’×ª ×–××Ÿ ×¢×“ ×”××™×•× ×”×¨××©×•×Ÿ
                if (gameState.threats === 0 && gameState.timeToFirstThreat > 0) {
                    gameState.timeToFirstThreat--;
                    
                    // ×”×¦×’×ª ×”×ª×¨××” ××—×¨×•× ×” ×œ×¤× ×™ ×”××™×•× ×”×¨××©×•×Ÿ
                    if (gameState.timeToFirstThreat === 30) {
                        showFirstThreatWarning();
                    }
                    
                    // ×™×¦×™×¨×ª ×”××™×•× ×”×¨××©×•×Ÿ
                    if (gameState.timeToFirstThreat === 0) {
                        createRandomThreat();
                        gameState.timeSinceLastThreat = 0;
                    }
                } 
                // ×™×¦×™×¨×ª ××™×•××™× × ×•×¡×¤×™× - ×¨×§ ×× ××™×Ÿ ×—×œ×•× ×™×ª ×œ××™×“×” ×¤×ª×•×—×”
                else if (gameState.threats > 0 && !gameState.isLearningModalOpen) {
                    // ×—×™×©×•×‘ ×–××Ÿ ×‘×™×Ÿ ××™×•××™× ×œ×¤×™ ×¨××” (××ª×—×™×œ ×-60 ×©× ×™×•×ª ×•×™×•×¨×“ ×”×“×¨×’×ª×™)
                    const currentTimeBetween = Math.max(30, gameState.timeBetweenThreats - (gameState.level - 1) * 10);
                    
                    if (gameState.timeSinceLastThreat >= currentTimeBetween) {
                        createRandomThreat();
                        gameState.timeSinceLastThreat = 0;
                    }
                }
                
                // ×¢×“×›×•×Ÿ ××™×•××™× ×§×™×™××™×
                updateThreats();
                
                // ×¢×“×›×•×Ÿ ×˜×™×™××¨×™× ×‘×”×ª×¨××•×ª ×¢×œ ×”××¡×š
                updateThreatAlerts();
                
                // ×‘×“×™×§×ª ×¢×œ×™×™×ª ×¨××” - ×¢×›×©×™×• ×™×•×ª×¨ ××™×˜×™ ×•××ª×—×©×‘
                if (gameState.score >= gameState.level * 300) { // ×”×’×“×œ×ª×™ ×-150 ×œ-300 × ×§×•×“×•×ª ×œ×¢×œ×™×™×ª ×¨××”
                    gameState.level++;
                    showLevelUp();
                }
                
                updateGameUI();
                updateDistrictStatuses();
                
            }, 1000);
        }
        
        // ×”×ª×¨××” ×œ×¤× ×™ ×”××™×•× ×”×¨××©×•×Ÿ
        function showFirstThreatWarning() {
            const title = 'âš ï¸ ×”××™×•× ×”×¨××©×•×Ÿ ××ª×§×¨×‘!';
            const content = `
                <p><strong>××œ×™× ×•×™, ×‘×¢×•×“ 30 ×©× ×™×•×ª ×™×•×¤×™×¢ ×”××™×•× ×”×¨××©×•×Ÿ ×©×œ×š!</strong></p>
                
                <h3>ğŸ¯ ××” ×œ×¢×©×•×ª:</h3>
                <ul>
                    <li>ğŸ’€ ×ª×•×¤×™×¢ ×”×ª×¨××” ×§×˜× ×” ×¢×œ ×”××¡×š</li>
                    <li>ğŸ—ºï¸ ×ª×™×›× ×¡×™ ×œ××¤×” ×•×ª×œ×—×¦×™ ×¢×œ ×”×¨×•×‘×¢ ×¢× ×”× ×§×•×“×” ×”××“×•××”</li>
                    <li>ğŸ“– ×ª×§×¨××™ ×‘×¢×™×•×Ÿ ××ª ×”××™×“×¢ ×¢×œ ×”××™×•×</li>
                    <li>ğŸ›¡ï¸ ×ª×œ×—×¦×™ ×¢×œ "×˜×¤×œ×™ ×‘××™×•×" ×›×“×™ ×œ× ×˜×¨×œ ××•×ª×•</li>
                </ul>
                
                <div style="background: rgba(0,210,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <p><strong>ğŸ’™ ×–×›×¨×™:</strong> ×™×© ×œ×š 2 ×“×§×•×ª ××œ××•×ª ×œ×˜×¤×œ ×‘××™×•× - ×”×¨×‘×” ×–××Ÿ ×œ×§×¨×•× ×•×œ×œ××•×“!</p>
                </div>
                
                <p><strong>ğŸ“ ××•×›× ×” ×œ×œ××•×“ ××©×”×• ×—×“×© ×•××¢× ×™×™×Ÿ?</strong></p>
            `;
            showModal(title, content);
            
            // ×¡×’×™×¨×” ××•×˜×•××˜×™×ª ××—×¨×™ 8 ×©× ×™×•×ª
            setTimeout(closeModal, 8000);
        }
        
        // ×™×¦×™×¨×ª ××™×•× ×¢× ×–××Ÿ ××•×ª×× ×œ×¨××” - 2 ×“×§×•×ª ×‘×¨××” 1
        function createRandomThreat() {
            const districts = ['HKLM', 'HKCU', 'HKCR', 'HKU', 'HKCC'];
            const randomDistrict = districts[Math.floor(Math.random() * districts.length)];
            
            // ×‘×—×™×¨×ª ××§×¨×” ×¨× ×“×•××™ ××”×‘× ×§
            const cases = districtCases[randomDistrict];
            const randomCase = cases[Math.floor(Math.random() * cases.length)];
            
            // ×—×™×©×•×‘ ×–××Ÿ ×œ×¤×™ ×¨××” - ××ª×—×™×œ ×-120 ×©× ×™×•×ª ×•×™×•×¨×“ ×”×“×¨×’×ª×™
            let timeForThreat;
            if (gameState.level === 1) {
                timeForThreat = 120; // 2 ×“×§×•×ª ××œ××•×ª ×‘×¨××” ×¨××©×•× ×”
            } else if (gameState.level === 2) {
                timeForThreat = 90; // ×“×§×” ×•×—×¦×™ ×‘×¨××” ×©× ×™×™×”
            } else if (gameState.level === 3) {
                timeForThreat = 70; // 70 ×©× ×™×•×ª ×‘×¨××” ×©×œ×™×©×™×ª
            } else {
                timeForThreat = Math.max(45, 120 - (gameState.level * 10)); // ××™× ×™××•× 45 ×©× ×™×•×ª
            }
            
            const newThreat = {
                id: Date.now(),
                district: randomDistrict,
                case: randomCase,
                severity: Math.floor(Math.random() * 3) + 1,
                timeLeft: timeForThreat,
                damage: Math.floor(Math.random() * 10) + 5 // ×¤×—×•×ª × ×–×§ ×‘×”×ª×—×œ×”
            };
            
            activeThreats.push(newThreat);
            gameState.threats++;
            
            // ×”×¦×’×ª ×”×ª×¨××ª ××™×•× ×¢×œ ×”××¡×š
            showThreatAlert(newThreat);
            
            console.log(`ğŸš¨ ××™×•× ×—×“×©: ${randomCase.name} ×‘-${randomDistrict} (${timeForThreat} ×©× ×™×•×ª)`);
        }
        
        // ×”×ª×¨××ª ××™×•× ×¢× ×¢×“×›×•×Ÿ ×˜×™×™××¨ ×‘×–××Ÿ ×××ª
        function showThreatAlert(threat) {
            // ×™×¦×™×¨×ª ×”×ª×¨××” ×¦×¤×”
            const alertDiv = document.createElement('div');
            alertDiv.className = 'threat-alert';
            alertDiv.id = `threat-alert-${threat.id}`;
            alertDiv.innerHTML = `
                <div class="threat-alert-content">
                    <div class="threat-alert-icon">ğŸš¨</div>
                    <div class="threat-alert-text">
                        <strong>××™×•× ×–×•×”×”!</strong><br>
                        <span style="font-size: 0.9rem;">${threat.case.nameExplained}</span><br>
                        <small style="color: #aaa;">×‘×¨×•×‘×¢: ${getDistrictName(threat.district)}</small>
                    </div>
                    <div class="threat-alert-timer" id="timer-${threat.id}">${Math.ceil(threat.timeLeft)}s</div>
                </div>
                <div style="text-align: center; margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px solid rgba(255,68,68,0.2);">
                    <small style="color: #aaa; font-size: 0.8rem;">
                        ğŸ–±ï¸ ×œ×—×¦×™ ×¢×œ ×¨×•×‘×¢ ${getDistrictName(threat.district)} ×œ×˜×™×¤×•×œ
                    </small>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            // ×”×¡×¨×” ××•×˜×•××˜×™×ª ××—×¨×™ 10 ×©× ×™×•×ª
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 10000);
        }
        
        // ×¢×“×›×•×Ÿ ×˜×™×™××¨×™× ×‘×”×ª×¨××•×ª
        function updateThreatAlerts() {
            activeThreats.forEach(threat => {
                const timerElement = document.getElementById(`timer-${threat.id}`);
                if (timerElement) {
                    timerElement.textContent = `${Math.ceil(threat.timeLeft)}s`;
                    
                    // ×©×™× ×•×™ ×¦×‘×¢ ×œ×¤×™ ×“×—×™×¤×•×ª
                    if (threat.timeLeft < 10) {
                        timerElement.style.background = 'rgba(255, 68, 68, 0.4)';
                        timerElement.style.color = '#ff4444';
                    } else if (threat.timeLeft < 30) {
                        timerElement.style.background = 'rgba(255, 170, 0, 0.4)';
                        timerElement.style.color = '#ffaa00';
                    }
                }
            });
        }
        
        // ×§×‘×œ×ª ×©× ×¨×•×‘×¢ ×‘×¢×‘×¨×™×ª
        function getDistrictName(code) {
            const names = {
                'HKLM': '×¨×•×‘×¢ ×”×××©×œ×”',
                'HKCU': '×¨×•×‘×¢ ×”××’×•×¨×™×', 
                'HKCR': '×¨×•×‘×¢ ×”××¡×—×¨',
                'HKU': '×›×™×›×¨ ×”×ª×•×©×‘×™×',
                'HKCC': '××¨×›×– ×”×‘×§×¨×”'
            };
            return names[code] || code;
        }
        
        // ×¢×“×›×•×Ÿ ××™×•××™×
        function updateThreats() {
            activeThreats = activeThreats.filter(threat => {
                threat.timeLeft--;
                
                if (threat.timeLeft <= 0) {
                    gameState.health -= threat.damage;
                    console.log(`ğŸ’¥ ××™×•× ×œ× ×˜×•×¤×œ! × ×–×§: ${threat.damage}`);
                    
                    // ×”×¡×¨×ª ×”×ª×¨××ª ×”××™×•× ××”××¡×š
                    const alertElement = document.getElementById(`threat-alert-${threat.id}`);
                    if (alertElement) {
                        alertElement.remove();
                    }
                    
                    if (gameState.health <= 0) {
                        gameOver();
                    }
                    return false;
                }
                return true;
            });
        }
        
        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×¨×•×‘×¢×™×
        function updateDistrictStatuses() {
            const districts = ['HKLM', 'HKCU', 'HKCR', 'HKU', 'HKCC'];
            
            districts.forEach(district => {
                const statusElement = document.getElementById(`status-${district}`);
                if (!statusElement) return;
                
                const threatsInDistrict = activeThreats.filter(t => t.district === district);
                
                statusElement.className = 'district-status';
                
                if (threatsInDistrict.length > 0) {
                    const hasUrgent = threatsInDistrict.some(t => t.timeLeft < 10);
                    const hasCritical = threatsInDistrict.some(t => t.timeLeft < 5);
                    
                    if (hasCritical) {
                        statusElement.classList.add('danger');
                    } else if (hasUrgent) {
                        statusElement.classList.add('warning');
                    }
                }
            });
        }
        
        // ×¢×œ×™×™×ª ×¨××” ×¢× ×”×¡×‘×¨ ×¢×œ ×”×©×™× ×•×™×™×
        function showLevelUp() {
            // ×—×™×©×•×‘ ×–×× ×™× ×—×“×©×™× ×œ×¨××” ×”×‘××”
            const newTimeBetween = Math.max(30, gameState.timeBetweenThreats - (gameState.level - 1) * 10);
            const newThreatTime = gameState.level === 1 ? 120 : 
                                 gameState.level === 2 ? 90 : 
                                 gameState.level === 3 ? 70 : 
                                 Math.max(45, 120 - (gameState.level * 10));
            
            const title = `ğŸ‰ ×¨××” ${gameState.level} - ×›×œ ×”×›×‘×•×“ ××œ×™× ×•×™!`;
            const content = `
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ†</div>
                    <p style="font-size: 1.4rem; font-weight: bold; color: #00ff88;">×¢×œ×™×ª ×¨××”!</p>
                </div>
                
                <div style="background: rgba(0,255,136,0.1); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0;">
                    <h3>ğŸ“Š ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×œ×š:</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                        <div style="text-align: center; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem;">ğŸ¯</div>
                            <div style="font-weight: bold; color: #00d2ff; font-size: 1.2rem;">${gameState.level}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">×¨××” × ×•×›×—×™×ª</div>
                        </div>
                        <div style="text-align: center; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem;">ğŸ’</div>
                            <div style="font-weight: bold; color: #00d2ff; font-size: 1.2rem;">${gameState.score}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">× ×§×•×“×•×ª</div>
                        </div>
                        <div style="text-align: center; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem;">ğŸ›¡ï¸</div>
                            <div style="font-weight: bold; color: #00d2ff; font-size: 1.2rem;">${gameState.health}%</div>
                            <div style="font-size: 0.9rem; color: #aaa;">×‘×¨×™××•×ª ×”×¢×™×¨</div>
                        </div>
                        <div style="text-align: center; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem;">ğŸš¨</div>
                            <div style="font-weight: bold; color: #00d2ff; font-size: 1.2rem;">${gameState.threats - activeThreats.length}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">××™×•××™× ×©×˜×™×¤×œ×ª</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(255,170,0,0.1); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; border: 2px solid rgba(255,170,0,0.3);">
                    <h3 style="color: #ffaa00; margin-bottom: 1rem;">âš ï¸ ×©×™× ×•×™×™× ×‘×¨××” ${gameState.level}:</h3>
                    
                    <div style="margin: 1rem 0;">
                        <p><strong>â° ×–××Ÿ ×œ×˜×™×¤×•×œ ×‘××™×•×:</strong></p>
                        <p style="font-size: 0.9rem; color: #ccc;">${newThreatTime} ×©× ×™×•×ª (×¤×—×•×ª ××”×¨××” ×”×§×•×“××ª)</p>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <p><strong>ğŸ•’ ×–××Ÿ ×‘×™×Ÿ ××™×•××™×:</strong></p>
                        <p style="font-size: 0.9rem; color: #ccc;">${Math.floor(newTimeBetween / 60)} ×“×§×•×ª ×•-${newTimeBetween % 60} ×©× ×™×•×ª</p>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <p><strong>ğŸ¯ ×œ×¨××” ×”×‘××”:</strong></p>
                        <p style="font-size: 0.9rem; color: #ccc;">×¢×•×“ ${(gameState.level + 1) * 300 - gameState.score} × ×§×•×“×•×ª</p>
                    </div>
                    
                    <div style="background: rgba(255,170,0,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p style="font-weight: bold; margin-bottom: 0.5rem;">ğŸ’¡ ×˜×™×¤ ×œ×¨××” ×”×‘××”:</p>
                        <p style="font-size: 0.9rem;">×”××™×•××™× ×”×•×œ×›×™× ×•× ×¢×©×™× ××ª×§×“××™× ×™×•×ª×¨! ×§×¨××™ ×‘×¢×™×•×Ÿ ××ª ×”×”×¡×‘×¨×™× ×›×“×™ ×œ×”×‘×™×Ÿ ×˜×•×‘ ××ª ×›×œ ××§×¨×”.</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <p style="font-size: 1.2rem; color: #00ff88; font-weight: bold;">
                        ğŸŒŸ ××¦×•×™×™×Ÿ! ××ª ×”×•×œ×›×ª ×œ×”×™×•×ª ××•××—×™×ª ××‘×˜×—×ª ××™×“×¢ × ×”×“×¨×ª!
                    </p>
                    <p style="font-size: 0.9rem; color: #aaa; margin-top: 0.5rem;">
                        ×”××©×™×›×™ ×›×›×” ×•×”×™×™ ×–×”×™×¨×” - ×”××™×•××™× ××ª×’×‘×¨×™×!
                    </p>
                </div>
            `;
            showModal(title, content);
            setTimeout(closeModal, 6000); // 6 ×©× ×™×•×ª ×œ×§×¨×•× ××ª ×›×œ ×”××™×“×¢
        }
        
        // ×¡×™×•× ×”××©×—×§
        function gameOver() {
            gameState.isGameRunning = false;
            clearInterval(gameTimer);
            
            const title = 'ğŸ’¥ ×”××©×—×§ ×”×¡×ª×™×™×!';
            const content = `
                <p><strong>××œ×™× ×•×™, ×”×¢×™×¨ × ×¤×œ×” ×œ×ª×•×§×¤×™×...</strong></p>
                <p>ğŸ¯ ×¨××” ×¡×•×¤×™×ª: ${gameState.level}</p>
                <p>ğŸ’ × ×§×•×“×•×ª ×¡×•×¤×™×•×ª: ${gameState.score}</p>
                <p>â° ×–××Ÿ ××©×—×§: ${Math.floor(gameState.gameTime / 60)} ×“×§×•×ª</p>
                <p>ğŸš¨ ××™×•××™× ×©×˜×™×¤×œ×ª: ${gameState.threats - activeThreats.length}</p>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="restartGame()" style="
                        background: #00d2ff; 
                        color: #000; 
                        border: none; 
                        padding: 1rem 2rem; 
                        border-radius: 8px; 
                        cursor: pointer; 
                        font-weight: bold;
                    ">ğŸ”„ ×©×—×§×™ ×©×•×‘</button>
                </div>
            `;
            showModal(title, content);
        }
        
        // ×”×¤×¢×œ×” ××—×“×©
        function restartGame() {
            closeModal();
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        // ×¢×“×›×•×Ÿ ×××©×§ ×”××©×—×§ - ×¢× ×”×¦×’×ª ×–××Ÿ ×¢×“ ××™×•×
        function updateGameUI() {
            document.getElementById('scoreValue').textContent = gameState.score;
            document.getElementById('levelValue').textContent = gameState.level;
            document.getElementById('healthFill').style.width = gameState.health + '%';
            
            // ×¢×“×›×•×Ÿ ×–××Ÿ ××©×—×§
            const minutes = Math.floor(gameState.gameTime / 60);
            const seconds = gameState.gameTime % 60;
            document.getElementById('timeValue').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // ×¢×“×›×•×Ÿ ××™×•××™× - ××• ×–××Ÿ ×¢×“ ××™×•× ×¨××©×•×Ÿ
            if (gameState.threats === 0 && gameState.timeToFirstThreat > 0) {
                const threatMinutes = Math.floor(gameState.timeToFirstThreat / 60);
                const threatSeconds = gameState.timeToFirstThreat % 60;
                document.getElementById('threatsValue').innerHTML = `<span style="color: #00ff88;">×¢×•×“ ${threatMinutes}:${threatSeconds.toString().padStart(2, '0')}</span>`;
            } else {
                document.getElementById('threatsValue').textContent = activeThreats.length;
            }
            
            // ×©×™× ×•×™ ×¦×‘×¢ ×‘×¨×™××•×ª
            const healthFill = document.getElementById('healthFill');
            if (gameState.health > 70) {
                healthFill.style.background = '#00ff88';
            } else if (gameState.health > 30) {
                healthFill.style.background = '#ffaa00';
            } else {
                healthFill.style.background = '#ff4444';
            }
        }
        
        // ×¤×ª×™×—×ª ×¨×•×‘×¢ ×¢× ×”×¡×‘×¨×™× ××¤×•×¨×˜×™× ×œ××ª×—×™×œ×•×ª
        function openDistrict(districtCode) {
            const districtNames = {
                'HKLM': { name: '×¨×•×‘×¢ ×”×××©×œ×”', icon: 'ğŸ›ï¸', fullName: 'HKEY_LOCAL_MACHINE' },
                'HKCU': { name: '×¨×•×‘×¢ ×”××’×•×¨×™×', icon: 'ğŸ ', fullName: 'HKEY_CURRENT_USER' },
                'HKCR': { name: '×¨×•×‘×¢ ×”××¡×—×¨', icon: 'ğŸª', fullName: 'HKEY_CLASSES_ROOT' },
                'HKU': { name: '×›×™×›×¨ ×”×ª×•×©×‘×™×', icon: 'ğŸ‘¥', fullName: 'HKEY_USERS' },
                'HKCC': { name: '××¨×›×– ×”×‘×§×¨×”', icon: 'âš™ï¸', fullName: 'HKEY_CURRENT_CONFIG' }
            };
            
            const district = districtNames[districtCode];
            const threatsInDistrict = activeThreats.filter(t => t.district === districtCode);
            
            let content = `
                <p><strong>ğŸ” ××œ×™× ×•×™, ×‘×—×¨×ª ×œ×—×§×•×¨ ××ª ${district.name}!</strong></p>
                
                <div style="background: rgba(0,210,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <h3>ğŸ“ ××™×§×•× ×‘×¨×’×™×¡×˜×¨×™:</h3>
                    <p style="font-family: monospace; background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 6px; margin: 0.5rem 0;">
                        ${district.fullName}
                    </p>
                    <p style="font-size: 0.9rem; color: #ccc;">
                        <strong>ğŸ’¡ ×”×¡×‘×¨:</strong> ×–×” ×”×›×ª×•×‘×ª ×”××“×•×™×§×ª ×‘×××’×¨ ×”××™×“×¢ ×©×œ Windows (×”×¨×’×™×¡×˜×¨×™) ×©×‘×• × ×©××¨×•×ª ×”×”×’×“×¨×•×ª ×©×œ ×”×¨×•×‘×¢ ×”×–×”.
                    </p>
                </div>
            `;
            
            // ×”×¦×’×ª ××™×•××™× ×¤×¢×™×œ×™× ×¢× ×”×¡×‘×¨×™× ××¤×•×¨×˜×™×
            if (threatsInDistrict.length > 0) {
                content += `<h3>ğŸš¨ ××™×•××™× ×¤×¢×™×œ×™× ×‘×¨×•×‘×¢:</h3>`;
                
                threatsInDistrict.forEach(threat => {
                    const urgency = threat.timeLeft < 10 ? '×§×¨×™×˜×™' : threat.timeLeft < 30 ? '×“×—×•×£' : '×‘×™× ×•× ×™';
                    const urgencyColor = threat.timeLeft < 10 ? '#ff4444' : threat.timeLeft < 30 ? '#ffaa00' : '#00ff88';
                    
                    content += `
                        <div style="background: rgba(255,68,68,0.1); border: 2px solid rgba(255,68,68,0.3); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                            
                            <!-- ×›×•×ª×¨×ª ×”××™×•× -->
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="font-size: 2rem;">âš ï¸</div>
                                <div>
                                    <h4 style="margin: 0; color: #ff6b6b; font-size: 1.2rem;">${threat.case.name}</h4>
                                    <p style="margin: 0; font-size: 0.9rem; color: #aaa;">${threat.case.nameExplained}</p>
                                </div>
                                <div style="margin-right: auto; text-align: right;">
                                    <div style="background: ${urgencyColor}; color: #000; padding: 0.3rem 0.8rem; border-radius: 20px; font-weight: bold; font-size: 0.9rem;">
                                        ${urgency}
                                    </div>
                                    <div style="font-size: 1.1rem; margin-top: 0.5rem; font-weight: bold;">
                                        â° ${Math.ceil(threat.timeLeft)} ×©× ×™×•×ª
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ×ª×™××•×¨ ×”××™×•× -->
                            <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                <p><strong>ğŸ“ ××” ×§×¨×”:</strong></p>
                                <p style="font-size: 1rem; line-height: 1.5;">${threat.case.description}</p>
                            </div>
                            
                            <!-- ××™×§×•× ×‘×¨×’×™×¡×˜×¨×™ -->
                            <div style="margin: 1rem 0;">
                                <p><strong>ğŸ“‚ ××™×§×•× ×‘×¨×’×™×¡×˜×¨×™:</strong></p>
                                <div style="font-family: monospace; background: rgba(0,0,0,0.4); padding: 1rem; border-radius: 6px; margin: 0.5rem 0; border-right: 4px solid #00d2ff;">
                                    ${threat.case.path}
                                </div>
                                <p style="font-size: 0.9rem; color: #bbb; background: rgba(0,210,255,0.1); padding: 0.8rem; border-radius: 6px;">
                                    <strong>ğŸ’¡ ×”×¡×‘×¨ ×”××™×§×•×:</strong> ${threat.case.pathExplained}
                                </p>
                            </div>
                            
                            <!-- ×”×¢×¨×š ×”×–×“×•× ×™ -->
                            <div style="margin: 1rem 0;">
                                <p><strong>ğŸ” ×”×¢×¨×š ×”×—×©×•×“ ×©×–×•×”×”:</strong></p>
                                <div style="font-family: monospace; background: rgba(255,68,68,0.2); padding: 1rem; border-radius: 6px; margin: 0.5rem 0; border-right: 4px solid #ff4444; color: #ff6b6b;">
                                    ${threat.case.malicious}
                                </div>
                                
                                <!-- ×¤×™×¨×•×§ ×”×¢×¨×š ×”×—×©×•×“ -->
                                <div style="background: rgba(255,170,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                    <p style="font-weight: bold; margin-bottom: 0.8rem;">ğŸ”¬ ×‘×•××™ × ×¤×¨×§ ××ª ×”×¢×¨×š ×”×–×”:</p>
                                    
                                    <div style="margin-bottom: 0.8rem;">
                                        <span style="background: rgba(255,170,0,0.3); padding: 0.2rem 0.6rem; border-radius: 4px; font-family: monospace;">
                                            ${threat.case.maliciousBreakdown.name}
                                        </span>
                                        <span style="margin-right: 0.5rem;">â†’</span>
                                        <span style="font-size: 0.9rem;">${threat.case.maliciousBreakdown.explanation}</span>
                                    </div>
                                    
                                    <div>
                                        <span style="background: rgba(255,170,0,0.3); padding: 0.2rem 0.6rem; border-radius: 4px; font-family: monospace;">
                                            ${threat.case.maliciousBreakdown.path}
                                        </span>
                                        <span style="margin-right: 0.5rem;">â†’</span>
                                        <span style="font-size: 0.9rem;">${threat.case.maliciousBreakdown.pathExplanation}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ×œ××™×“×” ×¢×œ ×”×¢×•×œ× ×”×××™×ª×™ -->
                            <div style="background: rgba(0,255,136,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border-right: 4px solid #00ff88;">
                                <p style="font-weight: bold; color: #00ff88; margin-bottom: 0.5rem;">ğŸ“ ×œ××™×“×”:</p>
                                <p style="font-size: 0.95rem; line-height: 1.5;">${threat.case.realWorld}</p>
                            </div>
                            
                            <!-- ×¡×›× ×•×ª ××¤×©×¨×™×•×ª -->
                            <div style="background: rgba(255,68,68,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                <p style="font-weight: bold; color: #ff6b6b; margin-bottom: 0.8rem;">âš ï¸ ××” ×¢×œ×•×œ ×œ×§×¨×•×ª ×× ×œ× × ×˜×¤×œ:</p>
                                <ul style="margin-right: 1rem;">
                `;
                
                threat.case.threats.forEach(threatItem => {
                    content += `<li style="margin-bottom: 0.3rem; font-size: 0.9rem;">${threatItem}</li>`;
                });
                
                content += `
                                </ul>
                            </div>
                            
                            <!-- ××™×š ×œ×–×”×•×ª -->
                            <div style="background: rgba(0,210,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                <p style="font-weight: bold; color: #00d2ff; margin-bottom: 0.5rem;">ğŸ” ××™×š ×œ×–×”×•×ª ×‘×¢×ª×™×“:</p>
                                <p style="font-size: 0.9rem;">${threat.case.howToSpot}</p>
                            </div>
                            
                            <!-- ×›×¤×ª×•×¨ ×˜×™×¤×•×œ -->
                            <div style="text-align: center; margin-top: 1.5rem;">
                                <button onclick="defuseThreat(${threat.id})" style="
                                    background: linear-gradient(45deg, #ff4444, #ff6b6b); 
                                    color: #fff; 
                                    border: none; 
                                    padding: 1rem 2rem; 
                                    border-radius: 12px; 
                                    cursor: pointer; 
                                    font-weight: bold;
                                    font-size: 1.1rem;
                                    box-shadow: 0 4px 15px rgba(255,68,68,0.4);
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                    ğŸ›¡ï¸ ×˜×¤×œ×™ ×‘××™×•× ×¢×›×©×™×•!
                                </button>
                            </div>
                        </div>
                    `;
                });
            } else {
                content += `
                    <div style="background: rgba(0,255,136,0.1); border: 2px solid rgba(0,255,136,0.3); padding: 1.5rem; border-radius: 12px; margin: 1rem 0; text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ›¡ï¸</div>
                        <p style="font-size: 1.2rem; font-weight: bold; color: #00ff88; margin-bottom: 0.5rem;">×”×¨×•×‘×¢ × ×§×™ ×××™×•××™×!</p>
                        <p style="font-size: 0.9rem; color: #ccc;">×–×” ×”×–××Ÿ ×”××•×©×œ× ×œ×œ××•×“ ×¢×œ ×”×¨×•×‘×¢ ×”×–×” ×•×œ×”×›×™×Ÿ ××ª ×¢×¦××š ×œ××™×•××™× ×¢×ª×™×“×™×™×.</p>
                    </div>
                `;
                
                // ×”×¦×’×ª ×“×•×’×××•×ª ×œ××™×“×” ××”×‘× ×§
                const availableCases = districtCases[districtCode];
                if (availableCases && availableCases.length > 0) {
                    const randomCase = availableCases[Math.floor(Math.random() * Math.min(2, availableCases.length))];
                    
                    content += `
                        <h3>ğŸ“š ×“×•×’××” ×œ×œ××™×“×” - ××™×•××™× × ×¤×•×¦×™× ×‘×¨×•×‘×¢:</h3>
                        <div style="background: rgba(0,210,255,0.1); border: 2px solid rgba(0,210,255,0.3); border-radius: 12px; padding: 1.5rem; margin: 1rem 0;">
                            <h4 style="color: #00d2ff; margin-bottom: 0.5rem;">ğŸ“‹ ${randomCase.name}</h4>
                            <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 1rem;">${randomCase.nameExplained}</p>
                            
                            <p style="margin-bottom: 1rem;"><strong>×ª×™××•×¨:</strong> ${randomCase.description}</p>
                            
                            <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                <p style="margin-bottom: 0.5rem;"><strong>××™×§×•×:</strong></p>
                                <div style="font-family: monospace; color: #00d2ff; font-size: 0.9rem;">
                                    ${randomCase.path}
                                </div>
                            </div>
                            
                            <div style="background: rgba(255,170,0,0.1); padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                <p style="margin-bottom: 0.5rem;"><strong>×“×•×’××ª ×¢×¨×š ×—×©×•×“:</strong></p>
                                <div style="font-family: monospace; color: #ffaa00; font-size: 0.9rem; background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 4px;">
                                    ${randomCase.malicious}
                                </div>
                            </div>
                            
                            <div style="background: rgba(0,255,136,0.1); padding: 1rem; border-radius: 6px;">
                                <p style="color: #00ff88; font-weight: bold; margin-bottom: 0.5rem;">ğŸ“ ×œ××™×“×”:</p>
                                <p style="font-size: 0.9rem;">${randomCase.realWorld}</p>
                            </div>
                        </div>
                    `;
                }
            }
            
            showModal(`${district.icon} ${district.name}`, content);
        }
        
        // ×˜×™×¤×•×œ ×‘××™×•× ×¢× ×”×¡×‘×¨ ××¤×•×¨×˜ - ×œ×œ× ×¡×’×™×¨×” ××•×˜×•××˜×™×ª
        function defuseThreat(threatId) {
            const threatIndex = activeThreats.findIndex(t => t.id === threatId);
            if (threatIndex === -1) return;
            
            const threat = activeThreats[threatIndex];
            // ×”×•×¨×“×ª×™ ××ª ×”× ×§×•×“×•×ª - ×¢×›×©×™×• ×¤×—×•×ª × ×§×•×“×•×ª ×œ××™×•×
            const points = threat.severity * 8 + Math.floor(threat.timeLeft / 5); // ×”×•×¨×“×ª×™ ×-20 ×œ-8, ×•×-/2 ×œ-/5
            
            gameState.score += points;
            activeThreats.splice(threatIndex, 1);
            
            // ×”×¡×¨×ª ×”×ª×¨××ª ×”××™×•× ××”××¡×š
            const alertElement = document.getElementById(`threat-alert-${threatId}`);
            if (alertElement) {
                alertElement.remove();
            }
            
            closeModal();
            
            // ×”×’×“×¨×ª ×”×“×’×œ ×©×—×œ×•× ×™×ª ×œ××™×“×” ×¤×ª×•×—×”
            gameState.isLearningModalOpen = true;
            
            const title = 'âœ… ×›×œ ×”×›×‘×•×“ ××œ×™× ×•×™! ×”××™×•× × ×•×˜×¨×œ!';
            const content = `
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ›¡ï¸</div>
                    <p style="font-size: 1.3rem; font-weight: bold; color: #00ff88;">××¦×•×™×™×Ÿ! ×˜×™×¤×œ×ª ×‘×”×¦×œ×—×” ×‘××™×•×!</p>
                </div>
                
                <div style="background: rgba(0,255,136,0.1); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; border: 2px solid rgba(0,255,136,0.3);">
                    <h3 style="color: #00ff88; margin-bottom: 1rem;">ğŸ¯ ××” ×¢×©×™×ª ×‘×“×™×•×§:</h3>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>ğŸ“‹ ×”××™×•× ×©× ×•×˜×¨×œ:</strong></p>
                        <p style="font-size: 1.1rem; color: #00d2ff;">${threat.case.name}</p>
                        <p style="font-size: 0.9rem; color: #aaa;">(${threat.case.nameExplained})</p>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>ğŸ”§ ××™×š ×–×” ×¢×•×‘×“ ×‘×¢×•×œ× ×”×××™×ª×™:</strong></p>
                        <p style="font-size: 0.95rem; line-height: 1.5;">
                            ×›×©××•××—×” ××‘×˜×—×ª ××™×“×¢ ××–×”×” ××™×•× ×›×–×”, ×”×•×:
                        </p>
                        <ul style="margin-right: 1.5rem; margin-top: 0.8rem;">
                            <li style="margin-bottom: 0.5rem;">ğŸ” <strong>××–×”×”</strong> ××ª ×”×¢×¨×š ×”×—×©×•×“ ×‘×¨×’×™×¡×˜×¨×™</li>
                            <li style="margin-bottom: 0.5rem;">ğŸ—‘ï¸ <strong>××•×—×§</strong> ××ª ×”×¢×¨×š ×”×–×“×•× ×™</li>
                            <li style="margin-bottom: 0.5rem;">ğŸ›¡ï¸ <strong>×¡×•×¨×§</strong> ×”×× ×™×© ×¢×•×“ ×§×‘×¦×™× ×–×“×•× ×™×™×</li>
                            <li style="margin-bottom: 0.5rem;">ğŸ“Š <strong>××ª×¢×“</strong> ××ª ×”××™×¨×•×¢ ×œ×¦×¨×›×™ ×—×§×™×¨×”</li>
                            <li style="margin-bottom: 0.5rem;">ğŸ”„ <strong>××’×‘×”</strong> ×¨×’×™×¡×˜×¨×™ × ×§×™</li>
                        </ul>
                    </div>
                    
                    <div style="background: rgba(0,210,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>ğŸ“ ××” ×œ××“×ª ×”×™×•×:</strong></p>
                        <p style="font-size: 0.95rem; line-height: 1.5;">${threat.case.realWorld}</p>
                    </div>
                    
                    <div style="background: rgba(255,170,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p style="color: #ffaa00; font-weight: bold; margin-bottom: 0.8rem;">ğŸ’¡ ×›×œ×™× ×©××•××—×™× ××©×ª××©×™× ×‘×”×:</p>
                        <ul style="margin-right: 1.5rem;">
                            <li style="margin-bottom: 0.3rem;"><strong>Sysmon:</strong> × ×™×˜×•×¨ ×©×™× ×•×™×™ ×¨×’×™×¡×˜×¨×™ ×‘×–××Ÿ ×××ª</li>
                            <li style="margin-bottom: 0.3rem;"><strong>Process Monitor:</strong> ××¢×§×‘ ××—×¨ ×’×™×©×” ×œ×¨×’×™×¡×˜×¨×™</li>
                            <li style="margin-bottom: 0.3rem;"><strong>Registry Editor:</strong> ×¢×¨×™×›×” ×™×“× ×™×ª ×©×œ ×¢×¨×›×™ ×¨×’×™×¡×˜×¨×™</li>
                            <li style="margin-bottom: 0.3rem;"><strong>PowerShell:</strong> ×¡×§×¨×™×¤×˜×™× ×œ× ×™×§×•×™ ××•×˜×•××˜×™</li>
                        </ul>
                    </div>
                </div>
                
                <div style="background: rgba(0,210,255,0.1); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; text-align: center;">
                    <h3 style="color: #00d2ff; margin-bottom: 1rem;">ğŸ† ×”×ª×•×¦××•×ª ×©×œ×š:</h3>
                    <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <div style="font-size: 2rem;">ğŸ’</div>
                            <div style="font-weight: bold; color: #00ff88;">+${points}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">× ×§×•×“×•×ª</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem;">ğŸ¯</div>
                            <div style="font-weight: bold; color: #00ff88;">${gameState.score}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">×¡×š × ×§×•×“×•×ª</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem;">â±ï¸</div>
                            <div style="font-weight: bold; color: #00ff88;">${Math.ceil(threat.timeLeft)}</div>
                            <div style="font-size: 0.9rem; color: #aaa;">×©× ×™×•×ª × ×•×ª×¨×•</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <p style="font-size: 1.1rem; color: #00ff88; font-weight: bold;">
                        ğŸŒŸ ××¦×•×™×™×Ÿ! ××ª ×”×•×œ×›×ª ×œ×”×™×•×ª ××•××—×™×ª ××‘×˜×—×ª ××™×“×¢ × ×”×“×¨×ª!
                    </p>
                    <p style="font-size: 0.9rem; color: #aaa; margin-top: 0.5rem;">
                        ×§×—×™ ××ª ×”×–××Ÿ ×©×œ×š ×œ×§×¨×•× - ×”××™×•× ×”×‘× ×™××ª×™×Ÿ ×œ×š ×‘×¡×‘×œ× ×•×ª
                    </p>
                </div>
            `;
            
            showModal(title, content);
            // ×”×¡×¨×ª ×”×¡×’×™×¨×” ×”××•×˜×•××˜×™×ª - ×”×—×œ×•× ×™×ª ×ª×™×©××¨ ×¤×ª×•×—×” ×¢×“ ×©××œ×™× ×•×™ ×ª×¡×’×•×¨
            
            updateGameUI();
            updateDistrictStatuses();
        }
        
        // ×¤×ª×™×—×ª ××¨×›×– ×”××‘×˜×—×”
        function openSecurityCenter() {
            const title = 'ğŸš¨ ××¨×›×– ×”×”×ª×¨××•×ª';
            
            let healthStatus = gameState.health > 70 ? '×”×¢×™×¨ ×‘×˜×•×—×”' : 
                              gameState.health > 30 ? '×”×¢×™×¨ ×‘×¡×™×›×•×Ÿ ×‘×™× ×•× ×™' : '×”×¢×™×¨ ×‘×¡×›× ×” ×—××•×¨×”!';
            
            let content = `
                <p><strong>×‘×¨×•×›×” ×”×‘××” ×œ××¨×›×– ×‘×™×˜×—×•×Ÿ ×”×¢×™×¨, ××œ×™× ×•×™!</strong></p>
                
                <h3>ğŸ“Š ×¡×˜×˜×•×¡ ×›×œ×œ×™:</h3>
                <div style="background: rgba(0,255,136,0.1); border: 1px solid rgba(0,255,136,0.3); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <p><strong>${healthStatus}</strong></p>
                    <p>ğŸ›¡ï¸ ×‘×¨×™××•×ª ×”×¢×™×¨: ${gameState.health}%</p>
                    <p>â° ×–××Ÿ ××©×—×§: ${Math.floor(gameState.gameTime / 60)}:${(gameState.gameTime % 60).toString().padStart(2, '0')}</p>
                    <p>ğŸ¯ ×¨××” × ×•×›×—×™×ª: ${gameState.level}</p>
                    <p>ğŸš¨ ××™×•××™× ×¤×¢×™×œ×™×: ${activeThreats.length}</p>
                </div>
            `;
            
            if (activeThreats.length > 0) {
                content += `<h3>âš ï¸ ×”×ª×¨××•×ª ×¤×¢×™×œ×•×ª:</h3>`;
                
                activeThreats.forEach(threat => {
                    const urgencyText = threat.timeLeft < 5 ? 'ğŸ”´ ×§×¨×™×˜×™' : 
                                      threat.timeLeft < 10 ? 'ğŸŸ¡ ×“×—×•×£' : 'ğŸŸ¢ ×‘×™× ×•× ×™';
                    
                    content += `
                        <div style="background: rgba(255,68,68,0.1); border: 1px solid rgba(255,68,68,0.3); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <p><strong>${urgencyText}: ${threat.case.name}</strong></p>
                            <p>×¨×•×‘×¢: ${threat.district} | ×–××Ÿ × ×•×ª×¨: ${Math.ceil(threat.timeLeft)} ×©× ×™×•×ª</p>
                            <button onclick="closeModal(); openDistrict('${threat.district}')" style="
                                background: #00d2ff; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; margin-top: 0.5rem;
                            ">ğŸ” ×—×§×¨×™ ×¨×•×‘×¢</button>
                        </div>
                    `;
                });
            } else {
                content += `
                    <div style="background: rgba(0,255,136,0.1); border: 1px solid rgba(0,255,136,0.3); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p>ğŸŸ¢ <strong>××™×Ÿ ××™×•××™× ×¤×¢×™×œ×™× ×›×¨×’×¢</strong></p>
                        <p>×”××©×™×›×™ ×œ×¢×§×•×‘ - ××™×•××™× ×—×“×©×™× ×¢×œ×•×œ×™× ×œ×”×•×¤×™×¢ ×‘×›×œ ×¨×’×¢!</p>
                    </div>
                `;
            }
            
            content += `
                <h3>ğŸ“ˆ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×”××©×—×§:</h3>
                <ul>
                    <li>ğŸ¯ ××™×•××™× ×©×˜×™×¤×œ×ª: ${gameState.threats - activeThreats.length}</li>
                    <li>ğŸ’ × ×§×•×“×•×ª ×©×¦×‘×¨×ª: ${gameState.score}</li>
                    <li>ğŸ›¡ï¸ ×©×™×¢×•×¨ ×”×¦×œ×—×”: ${Math.floor(((gameState.threats - activeThreats.length) / Math.max(gameState.threats, 1)) * 100)}%</li>
                </ul>
            `;
            
            showModal(title, content);
        }
        
        // ×”×¦×’×ª ××“×¨×™×š
        function showTutorial() {
            const title = 'ğŸ“ ××“×¨×™×š ×œ××ª×—×™×œ×•×ª - Registry City';
            const content = `
                <h3>ğŸ¤” ××œ×™× ×•×™, ××” ×–×” ×¨×’×™×¡×˜×¨×™ Windows?</h3>
                <p>×“××™×™× ×™ ×©×”××—×©×‘ ×©×œ×š ×”×•× ×¢×™×¨ ×¢× ×§×™×ª, ×•×”×¨×’×™×¡×˜×¨×™ ×”×•× <strong>××¨×›×– ×”×‘×§×¨×”</strong> ×©×× ×”×œ ××ª ×›×œ ×”×¢×™×¨.</p>
                
                <h3>ğŸ™ï¸ 5 ×¨×•×‘×¢×™ ×”×¢×™×¨ ×©×œ×š:</h3>
                
                <p><strong>ğŸ›ï¸ ×¨×•×‘×¢ ×”×××©×œ×” (HKEY_LOCAL_MACHINE)</strong><br>
                ×›××• ×¢×™×¨×™×™×ª ×”×¢×™×¨ - ×× ×”×œ ××ª ×›×œ ×”×©×™×¨×•×ª×™× ×©×—×œ×™× ×¢×œ ×›×•×œ×.</p>
                
                <p><strong>ğŸ  ×¨×•×‘×¢ ×”××’×•×¨×™× (HKEY_CURRENT_USER)</strong><br>
                ×”×‘×ª×™× ×”×¤×¨×˜×™×™× - ×”×”×’×“×¨×•×ª ×”××™×©×™×•×ª ×©×œ ×”××©×ª××©.</p>
                
                <p><strong>ğŸª ×¨×•×‘×¢ ×”××¡×—×¨ (HKEY_CLASSES_ROOT)</strong><br>
                ×”××¨×›×– ×”××¡×—×¨×™ - ×§×•×‘×¢ ××™×š ×§×‘×¦×™× × ×¤×ª×—×™×.</p>
                
                <p><strong>ğŸ‘¥ ×›×™×›×¨ ×”×ª×•×©×‘×™× (HKEY_USERS)</strong><br>
                ×›×œ ×”××©×ª××©×™× ×‘××¢×¨×›×ª.</p>
                
                <p><strong>âš™ï¸ ××¨×›×– ×”×‘×§×¨×” (HKEY_CURRENT_CONFIG)</strong><br>
                ×”×”×’×“×¨×•×ª ×”× ×•×›×—×™×•×ª ×©×œ ×”×—×•××¨×”.</p>
                
                <h3>ğŸ® ××™×š ×œ×©×—×§:</h3>
                <ul>
                    <li>×¢×§×‘×™ ××—×¨ ×”××™×•××™× ×©××•×¤×™×¢×™× ×‘×¨×•×‘×¢×™×</li>
                    <li>×œ×—×¦×™ ×¢×œ ×¨×•×‘×¢×™× ×›×“×™ ×œ×—×§×•×¨ ××™×•××™×</li>
                    <li>×˜×¤×œ×™ ×‘××™×•××™× ×œ×¤× ×™ ×©×’×•×¨××™× × ×–×§</li>
                    <li>×œ××“×™ ×¢×œ ×¡×™×™×‘×¨ ×××™×ª×™ ××›×œ ××§×¨×”!</li>
                </ul>
            `;
            showModal(title, content);
        }
        
        // ××•×“×•×ª ×”××©×—×§
        function showAbout() {
            const title = 'ğŸ® Registry City - ××•×“×•×ª ×”××©×—×§';
            const content = `
                <h3>ğŸ’¡ ××” ×–×” Registry City?</h3>
                <p>××©×—×§ ×—×™× ×•×›×™ ××ª×§×“× ×©××œ××“ <strong>××‘×˜×—×ª ××™×“×¢ ×•×¨×’×™×¡×˜×¨×™ Windows</strong> ×‘×¦×•×¨×” ××™× ×˜×¨××§×˜×™×‘×™×ª. ××™×•×¢×“ ×‘××™×•×—×“ ×¢×‘×•×¨ ××œ×™× ×•×™ ×©×‘×¢!</p>
                
                <h3>ğŸ¯ ××” ×ª×œ××“×™ ×‘××©×—×§?</h3>
                <ul>
                    <li><strong>××‘× ×” ×”×¨×’×™×¡×˜×¨×™</strong> - ××™×š Windows ×¢×•×‘×“ ××‘×¤× ×™×</li>
                    <li><strong>×˜×›× ×™×§×•×ª ×”×ª×§×¤×” ×××™×ª×™×•×ª</strong> - Registry Persistence, Browser Hijacking ×•×¢×•×“</li>
                    <li><strong>×©×™×˜×•×ª ×”×’× ×”</strong> - ×›×œ×™× ×›××• Sysmon, Registry monitoring</li>
                    <li><strong>××§×¨×™ ×‘×•×—×Ÿ ×××™×ª×™×™×</strong> - ×”××‘×•×¡×¡×™× ×¢×œ ××™×•××™× ××”×¢×•×œ× ×”×××™×ª×™</li>
                </ul>
                
                <h3>ğŸ”¥ ××” ×—×“×© ×‘××©×—×§:</h3>
                <ul>
                    <li>ğŸ² <strong>××§×¨×™× ×¨× ×“×•××™×™×</strong> - ×‘×›×œ ××©×—×§ ××§×¨×™× ×©×•× ×™×</li>
                    <li>â° <strong>×–××Ÿ ×××ª</strong> - ××™×•××™× ××•×¤×™×¢×™× ×›×œ ×”×–××Ÿ</li>
                    <li>ğŸ“š <strong>×œ××™×“×” ××¢×©×™×ª</strong> - ×›×œ ××§×¨×” ××œ××“ ××©×”×• ×—×“×©</li>
                    <li>ğŸ¯ <strong>××ª×’×¨ ×××™×ª×™</strong> - ×‘×¨×™××•×ª ×”×¢×™×¨ ×™×•×¨×“×ª ×× ×œ× ××˜×¤×œ×™×</li>
                </ul>
                
                <p><strong>ğŸš€ ×”××©×—×§ ××¤×•×ª×— ×‘××™×•×—×“ ×¢×‘×•×¨×š, ××œ×™× ×•×™!</strong></p>
            `;
            showModal(title, content);
        }
        
        // ×”××–× ×” ×œ××§×œ×“×ª
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('modalOverlay');
            if (modal && !modal.classList.contains('hidden')) {
                if (event.key === 'Escape' || event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    closeModal();
                }
            }
        });
        
        // ×¡×’×™×¨×ª ×”××•×“×œ ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢
        document.getElementById('modalOverlay').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });
        
        // ××ª×—×•×œ ×”××©×—×§
        window.onload = function() {
            createStars();
            console.log('Registry City Game Loaded Successfully! ğŸ®');
            console.log('Game created especially for Elonay! ğŸ’');
            console.log('Window size:', window.innerWidth, 'x', window.innerHeight);
            console.log('Screen size:', screen.width, 'x', screen.height);
            console.log('User agent:', navigator.userAgent);
            
            // ×•×™×“×•× ×©×”×ª×¤×¨×™×˜ ×”×¨××©×™ × ×¨××”
            const mainMenu = document.getElementById('mainMenu');
            console.log('Main menu display:', getComputedStyle(mainMenu).display);
            console.log('Main menu visibility:', getComputedStyle(mainMenu).visibility);
        };
    </script>
</body>
</html>